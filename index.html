<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dice Selector</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  body {
    margin: 0;
    font-family: -apple-system, system-ui, sans-serif;
    background: #111;
    color: white;
  }

  h2 {
    margin: 16px 0 8px;
    text-align: center;
    font-weight: 600;
  }

  .section {
    padding: 10px;
  }

  .dice-row {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .die {
    width: 120px;
    height: 120px;
    border-radius: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 60px;
    font-weight: bold;
    color: black;
    cursor: pointer;
    user-select: none;
  }

  .disabled {
    opacity: 1;
    pointer-events: none;
  }

  .buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin: 16px 0;
  }

  button {
    padding: 12px 20px;
    font-size: 16px;
    border: none;
    border-radius: 12px;
    background: #0a84ff;
    color: white;
  }

  button.secondary {
    background: #3a3a3c;
  }

  button:disabled {
    opacity: 0.4;
  }

  @keyframes rolling {
    0%, 100% { transform: rotateX(0deg) rotateY(0deg); }
    50% { transform: rotateX(360deg) rotateY(360deg); }
  }

  .die.rolling {
    animation: rolling 0.5s ease-in-out;
  }
</style>
</head>

<body>

<h2>Rollable Dice</h2>
<div class="section">
  <div id="rollable" class="dice-row"></div>
</div>

<div class="buttons">
  <button id="rollBtn">Roll</button>
  <button id="rerollBtn" class="secondary">Re-roll</button>
  <button id="resetBtn" class="secondary">Reset</button>
</div>

<h2>Selected</h2>
<div class="section">
  <div id="selected" class="dice-row"></div>
</div>

<h2>Discarded</h2>
<div class="section">
  <div id="discarded" class="dice-row"></div>
</div>

<script>
const MAX_SELECTIONS = 3;

const diceColors = [
  { name: "Yellow", color: "#FFD60A" },
  { name: "Blue", color: "#0A84FF" },
  { name: "Pink", color: "#FF8DA1" },
  { name: "Green", color: "#30D158" },
  { name: "White", color: "#FFFFFF" },
  { name: "Gray", color: "#8E8E93" }
];

let rollableDice = [];
let selectedDice = [];
let discardedDice = [];

const rollableEl = document.getElementById("rollable");
const selectedEl = document.getElementById("selected");
const discardedEl = document.getElementById("discarded");

const rollBtn = document.getElementById("rollBtn");
const rerollBtn = document.getElementById("rerollBtn");
const resetBtn = document.getElementById("resetBtn");

function resetGame() {
  rollableDice = diceColors.map(d => ({ ...d, value: null }));
  selectedDice = [];
  discardedDice = [];
  render();
}

function render() {
  rollableEl.innerHTML = "";
  selectedEl.innerHTML = "";
  discardedEl.innerHTML = "";

  // Add 3 empty placeholder dice to selected
  for (let i = 0; i < 3; i++) {
    const placeholder = document.createElement("div");
    placeholder.className = "die disabled";
    placeholder.style.background = "#3a3a3c";
    placeholder.textContent = "–";
    selectedEl.appendChild(placeholder);
  }

  rollableDice.forEach(die => {
    const el = createDie(die, () => selectDie(die));
    rollableEl.appendChild(el);
  });

  selectedDice.forEach(die => {
    const el = createDie(die);
    selectedEl.replaceChild(el, selectedEl.children[selectedDice.indexOf(die)]);
  });
  discardedDice.forEach(die => discardedEl.appendChild(createDie(die)));

  const hasUnrolled = rollableDice.some(d => d.value === null);
  rollBtn.disabled = !hasUnrolled || selectedDice.length >= MAX_SELECTIONS;
  rerollBtn.disabled = hasUnrolled || selectedDice.length >= MAX_SELECTIONS;
}

function createDie(die, onClick) {
  const el = document.createElement("div");
  el.className = "die";
  el.style.background = die.color;
  el.textContent = die.value ?? "–";

  if (onClick && die.value !== null) {
    el.onclick = onClick;
  } else {
    el.classList.add("disabled");
  }

  return el;
}

function rollDice() {
  // Add rolling animation to all rollable dice
  document.querySelectorAll("#rollable .die").forEach(die => {
    die.classList.add("rolling");
  });

  // Simulate animation duration before showing results
  setTimeout(() => {
    rollableDice.forEach(d => {
      d.value = Math.floor(Math.random() * 6) + 1;
    });
    render();
  }, 500);
}

function selectDie(selected) {
  if (selectedDice.length >= MAX_SELECTIONS) return;

  selectedDice.push(selected);

  rollableDice = rollableDice.filter(die => {
    if (die === selected) return false;
    if (die.value < selected.value) {
      discardedDice.push(die);
      return false;
    }
    return true;
  });

  // If max selections reached, discard all remaining rollable dice
  if (selectedDice.length === MAX_SELECTIONS) {
    discardedDice.push(...rollableDice);
    rollableDice = [];
  } else {
    // Otherwise clear values so user must roll again
    rollableDice.forEach(d => d.value = null);
  }

  render();
}

rollBtn.onclick = rollDice;
rerollBtn.onclick = rollDice;
resetBtn.onclick = resetGame;

resetGame();
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>